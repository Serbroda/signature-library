var MouseAction,Point=function(){function t(t,e,n){this.x=t,this.y=e,this.time=n||Date.now()}return t.prototype.distanceTo=function(t){return Math.sqrt(Math.pow(this.x-t.x,2))+Math.pow(this.y-t.y,2)},t.prototype.velocityFrom=function(t){return this.time===t.time?0:this.distanceTo(t)/(this.time-t.time)},t.prototype.equalTo=function(t){return this.x===t.x&&this.y===t.y&&this.time===t.time},t}(),Rect=function(){function t(t,e){this.smallest=t,this.largest=e,this.width=e.x-t.x,this.height=e.y-t.y}return t.createFromPointArray=function(e){for(var n=99999,a=99999,i=-1,s=-1,o=0,h=e;o<h.length;o++){var r=h[o];n>=r.x&&(n=r.x),a>=r.y&&(a=r.y),i<=r.x&&(i=r.x),s<=r.y&&(s=r.y)}return new t({x:n,y:a},{x:i,y:s})},t}(),Canvas2D=function(){function t(t,e){if(this.canvas=t,this._hasData=!1,this.context=e?e.context:this.canvas.getContext("2d"),e&&e.stroke&&this.setStroke(e.stroke),e&&e.font&&this.setFont(e.font),-1!==t.className.indexOf("signature-fullwidth")&&(t.width=t.parentElement.clientWidth),-1!==t.className.indexOf("signature-fullwidth-responsive")){var n=this;window.addEventListener("resize",function(){var e=n.saveImageData();n.canvas.width=t.parentElement.clientWidth,n.context.putImageData(e,0,0)})}this._hasData=!1}return t.prototype.drawLine=function(t,e){this.context.beginPath(),this.context.moveTo(t.x,t.y),this.context.lineTo(e.x,e.y),this.context.stroke(),this.context.closePath(),this._hasData=!0},t.prototype.drawDot=function(t){this.context.beginPath(),this.context.fillStyle="black",this.context.fillRect(t.x,t.y,this.context.lineWidth,this.context.lineWidth),this.context.closePath(),this._hasData=!0},t.prototype.drawText=function(t,e,n){var a=n||this.getFont();this.setFont(a),this.context.fillText(t,e.x,e.y),this._hasData=!0},t.prototype.drawImage=function(t,e){var n=e||{x:0,y:0};this.context.putImageData(t,n.x,n.y)},t.prototype.uploadImage=function(t){var e=this,n=new FileReader;n.onload=function(t){var n=new Image;n.onload=function(){e.canvas.width=n.width,e.canvas.height=n.height,e.context.drawImage(n,0,0)},n.src=t.target.result},n.readAsDataURL(t.target.files[0])},t.prototype.clear=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this._hasData=!1},t.prototype.setStroke=function(t){this.context.lineWidth=t.lineWidth||this.context.lineWidth,this.context.strokeStyle=t.strokeStyle||this.context.strokeStyle,this.context.shadowColor=t.shadowColor||this.context.shadowColor,this.context.shadowBlur=t.shadowBlur||this.context.shadowBlur,t.lineDash&&this.context.setLineDash(t.lineDash)},t.prototype.getStroke=function(){return{lineWidth:this.context.lineWidth,lineDash:this.context.getLineDash(),strokeStyle:this.context.strokeStyle,shadowBlur:this.context.shadowBlur,shadowColor:this.context.shadowColor}},t.prototype.getFont=function(){return this.context.font},t.prototype.setFont=function(t){this.context.font=t},t.prototype.copy=function(){return t.copyFrom(this)},t.prototype.hasData=function(){return this._hasData},t.prototype.save=function(t){switch((t||{type:"base64"}).type){case"imageData":return this.saveImageData();case"bytes":return this.saveArrayBuffer();default:return this.saveBase64()}},t.prototype.saveBase64=function(t,e){return void 0===t&&(t="image/png"),this.canvas.toDataURL(t,e)},t.prototype.saveArrayBuffer=function(){for(var t=this.save(),e=window.atob(t),n=e.length,a=new Uint8Array(n),i=0;i<n;i++)a[i]=e.charCodeAt(i);return a.buffer},t.prototype.saveImageData=function(){return this.context.getImageData(0,0,this.canvas.width,this.canvas.height)},t.prototype.saveCropped=function(t,e,n){void 0===e&&(e="image/png");var a=this.context.getImageData(t.smallest.x,t.smallest.y,t.width,t.height),i=document.createElement("canvas");return i.width=a.width,i.height=a.height,i.style.border="1px solid black",i.getContext("2d").putImageData(a,0,0),document.getElementsByTagName("body")[0].appendChild(i),i.toDataURL(e,n)},t.copyFrom=function(e){var n=document.createElement("canvas");n.width=e.canvas.width,n.height=e.canvas.height;var a=n.getContext("2d");return a.lineWidth=e.context.lineWidth,a.strokeStyle=e.context.strokeStyle,a.shadowColor=e.context.shadowColor,a.shadowBlur=e.context.shadowBlur,a.setLineDash(e.context.getLineDash()),a.font=e.context.font,new t(n,{context:a})},t}(),ISignatureCanvasOptions=function(){return function(){}}(),SignatureCanvas=function(){function t(t,e){void 0===e&&(e={}),this.baseOptions=e,this.leadingLines=[],this.baseCanvasElement=t,e.leadingLines&&(this.leadingLines=e.leadingLines),this.init()}return t.prototype.init=function(){this.viewCanvas=new Canvas2D(this.baseCanvasElement),this.dataCanvas=this.viewCanvas.copy(),this.addLeadingLine({start:{x:0,y:this.baseCanvasElement.height-this.baseCanvasElement.height/4},end:{x:this.baseCanvasElement.width,y:this.baseCanvasElement.height-this.baseCanvasElement.height/4},stroke:{lineWidth:1.5,lineDash:[],strokeStyle:"#3498db",shadowBlur:0,shadowColor:"#3498db"}}),this.addLeadingLine({start:{x:0,y:this.baseCanvasElement.height/2},end:{x:this.baseCanvasElement.width,y:this.baseCanvasElement.height/2},stroke:{lineWidth:1.5,lineDash:[5,4],strokeStyle:"#e8e8e8",shadowBlur:0,shadowColor:"#e8e8e8"}}),this.addLeadingLine({start:{x:0,y:this.baseCanvasElement.height/4},end:{x:this.baseCanvasElement.width,y:this.baseCanvasElement.height/4},stroke:{lineWidth:1.5,lineDash:[2,1],strokeStyle:"#e8e8e8",shadowBlur:0,shadowColor:"#e8e8e8"}}),this.drawLeadingLines(),this.baseOptions.stroke&&(this.viewCanvas.setStroke(this.baseOptions.stroke),this.dataCanvas.setStroke(this.baseOptions.stroke))},t.prototype.addLeadingLine=function(t){this.leadingLines.push(t)},t.prototype.drawLeadingLines=function(){for(var t=this.viewCanvas.getStroke(),e=0,n=this.leadingLines;e<n.length;e++){var a=n[e];this.viewCanvas.setStroke(a.stroke),this.viewCanvas.drawLine(a.start,a.end)}this.viewCanvas.setStroke(t)},t.prototype.clear=function(t){void 0===t&&(t=!0),this.viewCanvas.clear(),this.dataCanvas.clear(),t&&this.drawLeadingLines()},t.prototype.drawLine=function(t,e){this.viewCanvas.drawLine(t,e),this.dataCanvas.drawLine(t,e)},t.prototype.drawDot=function(t){this.viewCanvas.drawDot(t),this.dataCanvas.drawDot(t)},t.prototype.setFont=function(t){this.viewCanvas.setFont(t),this.dataCanvas.setFont(t)},t.prototype.hasData=function(){return this.dataCanvas.hasData()},t.prototype.save=function(){return this.dataCanvas.save()},t.prototype.saveCropped=function(t,e,n){return void 0===e&&(e="image/png"),this.dataCanvas.saveCropped(t,e,n)},t}(),__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function a(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}();!function(t){t[t.DOWN=0]="DOWN",t[t.UP=1]="UP",t[t.MOVE=2]="MOVE",t[t.OUT=3]="OUT"}(MouseAction||(MouseAction={}));var SignPad=function(t){function e(e,n){void 0===n&&(n={lineWidth:2,docReference:document});var a=t.call(this,e,{stroke:{lineWidth:n.lineWidth}})||this;return a.options=n,a.data=[],a.isMouseDown=!1,a.options.docReference=a.options.docReference||document,a.mouseEvents(),a}return __extends(e,t),e.prototype.mouseEvents=function(){var t=this;this.viewCanvas.canvas.addEventListener("mousemove",function(e){t.handleMouseEvent(MouseAction.MOVE,e)},!1),this.viewCanvas.canvas.addEventListener("mousedown",function(e){t.handleMouseEvent(MouseAction.DOWN,e)},!1),this.options.docReference.addEventListener("mouseup",function(e){t.handleMouseEvent(MouseAction.UP,e)},!1)},e.prototype.handleMouseEvent=function(t,e){switch(t){case MouseAction.DOWN:this.isMouseDown=!0;var n=this.createPoint(e);this.data.push(n),this.drawDot(n);break;case MouseAction.UP:case MouseAction.OUT:this.isMouseDown=!1;break;case MouseAction.MOVE:n=this.createPoint(e);this.isMouseDown&&(this.drawLine(this.getPreviousPoint(),n),this.data.push(n))}},e.prototype.clear=function(e){void 0===e&&(e=!0),t.prototype.clear.call(this,e),this.data=[]},e.prototype.getPreviousPoint=function(t){t||this.data;return 0==this.data.length?new Point(0,0):1==this.data.length?this.data[0]:this.data[this.data.length-1]},e.prototype.createPoint=function(t){var e=this.viewCanvas.canvas.getBoundingClientRect();return new Point(t.clientX-e.left,t.clientY-e.top)},e.prototype.save=function(e,n){return void 0===e&&(e="image/png"),t.prototype.saveCropped.call(this,Rect.createFromPointArray(this.data),e,n)},e.prototype.save2=function(e,n){void 0===e&&(e="image/png");var a=document.createElement("canvas").getContext("2d"),i=t.prototype.save.call(this),s=new Image;s.onload=function(){a.drawImage(s,0,0)},s.src=i;var o=this.getRectRange(),h=a.getImageData(o.smallest.x,o.smallest.y,o.biggest.x,o.biggest.y),r=document.createElement("canvas");r.width=o.biggest.x-o.smallest.x,r.height=o.biggest.y-o.smallest.y;var c=r.getContext("2d");return c.rect(0,0,o.biggest.x-o.smallest.x,o.biggest.y-o.smallest.y),c.fillStyle="white",c.fill(),c.putImageData(h,0,0),r.toDataURL(e,n)},e.prototype.getRectRange=function(){console.log(this.data);for(var t=99999,e=99999,n=-1,a=-1,i=0,s=this.data;i<s.length;i++){var o=s[i];t>=o.x&&(t=o.x),e>=o.y&&(e=o.y),n<=o.x&&(n=o.x),a<=o.y&&(a=o.y)}return{smallest:new Point(t,e),biggest:new Point(n,a),width:n-t,height:a-e}},e}(SignatureCanvas),TextSignature=(__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function a(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),function(t){function e(e,n){void 0===n&&(n={fontSize:"70px",fontFamily:"Signature",docReference:document});var a=t.call(this,e)||this;return a.options=n,a.options.docReference=a.options.docReference||document,a.loadFont(a.options.fontFamily),a}return __extends(e,t),e.prototype.drawText=function(t,e,n){var a=n||this.getFont();this.viewCanvas.setFont(a),this.dataCanvas.setFont(a),this.clear(),void 0!==e&&e||this.viewCanvas.drawText(t,{x:10,y:this.viewCanvas.canvas.height-this.viewCanvas.canvas.height/4-5}),this.dataCanvas.context.measureText(t).width>this.viewCanvas.canvas.width?(this.dataCanvas.canvas.width=this.dataCanvas.context.measureText(t).width+10,this.viewCanvas.setFont(a),this.dataCanvas.setFont(a)):this.dataCanvas.canvas.width<this.viewCanvas.canvas.width&&(this.dataCanvas.canvas.width=this.viewCanvas.canvas.width+10,this.viewCanvas.setFont(a),this.dataCanvas.setFont(a)),this.dataCanvas.drawText(t,{x:10,y:this.dataCanvas.canvas.height-this.dataCanvas.canvas.height/4-5})},e.prototype.getFont=function(){return this.options.fontSize+" "+this.options.fontFamily},e.prototype.setFont=function(e){t.prototype.setFont.call(this,e)},e.prototype.loadFont=function(t){var e=document.createElement("p");e.id="__fontFamilyLoad"+t,e.style.fontFamily=t,e.innerText="test";document.getElementsByTagName("body")[0].appendChild(e);setTimeout(function(){void 0!==e.remove?e.remove():e.style.display="none"},1)},e}(SignatureCanvas));